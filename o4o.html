<title>OAuth for Okta</title>
<style>
body {
    font-family: sans-serif;
}
</style>
<h1>OAuth for Okta</h1>
<div id=app>Loading...</div>
<script>
onload = async function () {
    paths = []
    r = await fetch('https://raw.githubusercontent.com/okta/okta-sdk-java/master/src/swagger/api.yaml')
    lines = (await r.text()).split('\n')
    lines.forEach(line => {
        if (match = line.match(/^  '?(\/.*?)'?:/)) {
            path = match[1]
        } else if (match = line.match(/^    (get|post|put|delete)/)) {
            method = match[1]
            paths.push({method, path})
        } else if (match = line.match(/^  version: (.*)/)) {
            version = match[1]
        }
    })

    base = 'https://gsroka-neto.oktapreview.com'
    headers = {Authorization: 'Bearer invalidToken'}

    rows = await Promise.all(paths.map(async ({method, path}) => {
        try {
            r = await fetch(base + path, {headers, method})
            scope = r.headers.get('www-authenticate').match(/scope="(.*?)"/)[1]
        } catch (e) {
            scope = ''
        }
        return `<tr><td>${method}<td>${path}<td>${scope}`
    }))
    app.innerHTML = `<a href="https://github.com/okta/okta-sdk-java/blob/master/src/swagger/api.yaml">Swagger v. ${version}</a>` +
        '<table><tr><th>Method<th>Path<th>Scope' + rows.join('') + '</table>'
}
</script>
