<!doctype html>
<html lang="en">
<head>
<meta name="viewport" content="initial-scale=1.0, minimum-scale=0.25">
<title>Hacker News</title>
<style>
body {
    font-family: sans-serif;
    font-size: 1em;
}
a:link {
    color: #000000;
    text-decoration: none; 
}
a:visited {
    color: #828282;
    text-decoration: none;
}
li {
    border-bottom: 1px solid silver;
    margin-bottom: 14px;
    padding-bottom: 14px;
}
</style>
</head>
<body>
<header><a href="https://news.ycombinator.com">Hacker News</a></header>
<main>
<ol id=content></ol>
</main>
<nav>
<span id=prev>Prev</span> | <span id=next>Next</span>
<br><br><br><br>
</nav>
<script>
var ids;
var start = 0;
var n = 1;

const pageLen = 30;
const baseUrl = "https://hacker-news.firebaseio.com/v0"; // see https://github.com/HackerNews/API

var content = document.getElementById("content");
document.getElementById("prev").onclick = () => {
    if (start < pageLen * 2) return;
    start -= pageLen * 2;
    n = start + 1;
    getItems();
};
document.getElementById("next").onclick = getItems;

fetch(baseUrl + "/topstories.json")
.then(response => response.json())
.then(_ids => {
    ids = _ids;
    getItems();
});

// TODO: Items might render out of order. Do we care?
function getItems() {
    function showItem(item) { // other item props: kids
        const hnBaseUrl = "https://news.ycombinator.com";
        var hnItemUrl = `${hnBaseUrl}/item?id=${item.id}`;
        if (item.url) {
            var site = new URL(item.url).hostname.replace(/^www\./, "");
            var ln1 = `${anc(item.url, item.title)} (${anc(hnBaseUrl + "/from?site=" + site, site)})`;
        } else {
            ln1 = anc(hnItemUrl, item.title);
        }
        var ago = new Date() / 1000 - item.time; // in seconds, 60 s == 1 min, 3600 s = 1 hr, etc.
        if (ago < 3600) {
            ago = plu(Math.round(ago / 60), "minute");
        } else if (ago < 3600 * 24) {
            ago = plu(Math.round(ago / 3600), "hour");
        } else {
            ago = plu(Math.round(ago / 3600 / 24), "day");
        }
        var ln2 = anc(hnItemUrl, ago + " ago");
        if (item.type != "job") {
            var cmt = anc(hnItemUrl, item.descendants == 0 ? "discuss" : plu(item.descendants, "comment"));
            ln2 = `${plu(item.score, "point")} by ${anc(hnBaseUrl + "/user?id=" + item.by, item.by)} ${ln2} | ${cmt}`;
        }
        content.innerHTML += `<li value=${n++}>${ln1}<br>${ln2}</li>`;
    }
    function anc(href, text) {
        return `<a href='${href}' target='_blank' rel='noopener'>${text}</a>`;
    }
    function plu(n, s) {
        return n + " " + (n == 1 ? s : s + "s");
    }
    content.innerHTML = "";
    for (var i = start; i < Math.min(start + pageLen, ids.length); i++) {
        fetch(`${baseUrl}/item/${ids[i]}.json`)
        .then(response => response.json())
        .then(showItem);
    }
    start = i;
}
</script>
</body>
</html>
