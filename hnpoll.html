<title>HN Poll</title>
<div id=h></div>
<div id=app>Loading...</div>
<script>
(async function() {
    const base = 'https://hacker-news.firebaseio.com/v0/item/';
    const id = new URLSearchParams(location.search).get('id') || '30210378';
    const r = await fetch(base + id + '.json');
    const poll = await r.json();
    h.innerHTML = `<a href='https://news.ycombinator.com/item?id=${id}'>` + poll.title + '</a>';
    const items = await Promise.all(poll.parts.map(async i => {
        const r = await fetch(`${base}${i}.json`);
        return await r.json();
    }));
    items.sort((a, b) => b.score - a.score || a.text.localeCompare(b.text));
    items.push({text: 'Total', score: items.map(a => a.score).reduce((a,b) => a + b)});
    app.innerHTML = '<table>' + items.map(e => `<tr><td>${e.text}<td align=right>${e.score}`).join('') + '</table>';
})();
</script>
