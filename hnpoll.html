<meta name="viewport" content="initial-scale=1.0, minimum-scale=0.25">
<style>
body {
    font-family: sans-serif;
    font-size: 1em;
}
@media (prefers-color-scheme: dark) {
    body {
        background-color: #121212;
        color: #888;
    }
}
</style>
<title>HN Poll</title>
<div id=hdr></div>
<div id=app>Loading...</div>
<script>
(async function() {
    // see https://github.com/HackerNews/API and https://nate.org/hacker-news-location-poll
    const base = 'https://hacker-news.firebaseio.com/v0/item/';
    const id = new URLSearchParams(location.search).get('id') || '30210378';
    const r = await fetch(base + id + '.json');
    const poll = await r.json();
    hdr.innerHTML = `<a href='https://news.ycombinator.com/item?id=${id}'>` + poll.title + '</a>';
    const items = await Promise.all(poll.parts.map(async i => {
        const r = await fetch(`${base}${i}.json`);
        const part = await r.json();
        part.score--; // all items start with score of 1, so -1 to see actual votes.
        return part;
    }));
    items.sort((a, b) => b.score - a.score || a.text.localeCompare(b.text));
    items.push({text: '<b>Total</b>', score: '<b>' + items.map(a => a.score).reduce((a, b) => a + b) + '</b>'});
    app.innerHTML = '<table>' + items.map(e => `<tr><td>${e.text}<td align=right>${e.score}`).join('') + '</table>';
})();
</script>
