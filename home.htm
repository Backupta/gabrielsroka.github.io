<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>My Apps</title>
<link href="https://ok3static.oktacdn.com/assets/css/widgets/chosen.a7aa2f61c6950df36987b8273c15a6be.css" type="text/css" rel="stylesheet"/>
<link href="https://ok3static.oktacdn.com/assets/css/enduser/enduser.be9c75cd7f709dbb05ac1ab439ea9ec4.css" type="text/css" rel="stylesheet"/>
<link href="https://ok3static.oktacdn.com/assets/css/widgets/jquery.qtip.188d7d3c1fd4644f3496390bc187bd08.css" type="text/css" rel="stylesheet"/>
<style type="text/css">
.app-button .logo {
    visibility: visible;
}
</style>
</head>
<body>
<div id="app"></div>
<script>
var baseUrl = 'https://gsroka-neto.oktapreview.com';
var init = {credentials: 'include'}; // For this work, enable CORS in Okta.
// var init = {mode: 'cors'}; // this didn't seem to work.

var app = document.getElementById("app");
fetch(`${baseUrl}/api/v1/users/me/appLinks`, init)
.then(response => response.json())
.then(links => {
    var html = "<ul>";
    links.sort((link1, link2) => link1.sortOrder < link2.sortOrder ? -1 : 1)
    .forEach(link => html += `<li class='app-button-wrapper'>
        <a href='${link.linkUrl}' target='_blank' class='app-button'><img src='${link.logoUrl}' class='logo'/></a>
        <p class='app-button-name'>${link.label}`);
    html += "</ul>";
    app.innerHTML = html;
}).catch(error => {
    app.innerHTML = `Are you signed in? <a href='${baseUrl}?fromUrl=${location.href}'>Sign in</a>`;
    // TODO: show Sign in Widget? SPA? redirect?
});
</script>
</body>
</html>
