<!doctype html>
<html>
<head>
<title>Okta - Add Person</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<style type="text/css">
body, pre {
    font-family: Arial, sans-serif;
    font-size: 10pt;
}
td {
    padding-left: 4px;
    padding-right: 4px;
}
.error {
    color: red;
}
</style>
</head>
<body>
<form>
<table>
<tr><td>First name<td><input id="firstName"><td id="firstNameError" class="error">
<tr><td>Last name<td><input id="lastName"><td id="lastNameError" class="error">
<tr><td>Username<td><input id="login"><td id="loginError" class="error">
<tr><td>Email<td><input id="email"><td id="emailError" class="error">
<tr><td>Password<td><input id="password" type="password"><td id="passwordError" class="error">
<tr><td>Verify password<td><input id="password2" type="password">
</table>
<br>
<button type="submit">Add Person</button>
</form>
<br>
<div id="results"></div>
<script src="oktaAPIsettings.js"></script>
<script src="oktaAPI.js"></script>
<script>
/* The oktaAPIsettings.js file should have these 2 variables defined, with YOUR values:
var baseurl = "https://YOUR_ORG.oktapreview.com";
var apitoken = "YOUR_TOKEN"
*/

var firstName = document.getElementById("firstName");
var lastName = document.getElementById("lastName");
var login = document.getElementById("login");
var email = document.getElementById("email");
var password = document.getElementById("password");
var password2 = document.getElementById("password2");

var firstNameError = document.getElementById("firstNameError");
var lastNameError = document.getElementById("lastNameError");
var loginError = document.getElementById("loginError");
var emailError = document.getElementById("emailError");
var passwordError = document.getElementById("passwordError");
var results = document.getElementById("results");

firstName.select();

document.forms[0].onsubmit = function () {
    firstNameError.innerHTML = "";
    lastNameError.innerHTML = "";
    loginError.innerHTML = "";
    emailError.innerHTML = "";
    passwordError.innerHTML = "";
    results.innerHTML = "";
    
    var emailRe = /.+@.+\..+/;
    var error = false;
    if (!firstName.value) {
        firstNameError.innerHTML = "First name cannot be left blank";
        error = true;
    }
    if (!lastName.value) {
        lastNameError.innerHTML = "Last name cannot be left blank";
        error = true;
    }
    if (!login.value.match(emailRe)) {
        loginError.innerHTML = "Username must be in the form of an email address (e.g. bob@nowhere.com)";
        error = true;
    }
    if (!email.value.match(emailRe)) {
        emailError.innerHTML = "Email must be in the form of an email address (e.g. bob@nowhere.com)";
        error = true;
    }
    if (password.value != password2.value) {
        passwordError.innerHTML = "Passwords don't match";
        error = true;
    }
    if (!error) {
        var profile = {firstName: firstName.value, lastName: lastName.value, login: login.value, email: email.value};
        var user = {profile: profile, credentials: {password: {value: password.value}}};
        newUser({user: user, onload: showResponse});
    }
    return false; // Cancel form.submit.
};

function showResponse() {
    var OK = 200;
    if (this.status == OK) {
        results.innerHTML = "OK";
    } else {
        var causes = JSON.parse(this.responseText).errorCauses;
        for (var c = 0; c < causes.length; c++) {
            var summary = causes[c].errorSummary;
            if (summary.match(/(firstName|lastName|login|email):/)) {
                var parts = summary.split(":");
                document.getElementById(parts[0] + "Error").innerHTML = parts[1];
            } else if (summary.match(/password/i)) {
                passwordError.innerHTML = summary;
            } else {
                results.innerHTML += summary;
            }
        }
    }
}
</script>
</body>
</html>
